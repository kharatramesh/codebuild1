version: 0.2
env:
  parameter-store:
    DOCKER_USER: /CodeBuild/DOCKER_USER
    DOCKER_PASSWORD: /CodeBuild/DOCKER_PASSWORD
phases:
  install:
    commands:
      - echo "Installing Docker"
      - cat /etc/os-release
      - id
      - uname -a
      - sudo apt-get update -y
      - sudo apt-get install \
             ca-certificates \
             curl \
             gnupg \
             lsb-release
      - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
      - echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null 
      - systemctl enable --now docker
  pre_build:
    commands:
      - echo "Login to docker hub"
      - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
  build:
    commands:
      - echo "starting creating image"
      - docker build . -t $DOCKER_USER/buildcode:buidcode1
      
  post_build:
    commands:
       - echo "pushing image to docker hub"
       - docker push $DOCKER_USER/buildcode:buidcode1
artifacts:
  files:
    - ./$DOCKER_USER/buildcode:buidcode1 
    