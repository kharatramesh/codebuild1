version: 0.2
env:
  parameter-store:
    DOCKER_USER: /CodeBuild/DOCKER_USER
    DOCKER_PASSWORD: /CodeBuild/DOCKER_PASSWORD
phases:
  install:
    #  runtime-versions:
    #  aws/codebuild/standard:5.0
    commands:
      
      - echo "Installing Docker"
      - cat /etc/os-release
      - id
      #- uname -a
      # - nohup /usr/local/bin/dockerd --host=unix:///var/run/docker.sock --host=tcp://127.0.0.1:2375 --storage-driver=overlay2 &
     #  - nohup /usr/local/bin/dockerd --host=unix:///var/run/docker.sock --host=tcp://127.0.0.1:2375 &
      # - timeout 20 sh -c "until docker info; do echo .; sleep 1; done"
    #  - systemctl status docker
    #  - docker ps
     # - sudo apt-get update -y
     # - sudo apt-get install \
     #        ca-certificates \
     #        curl \
     #        gnupg \
     #        lsb-release
     # - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
     # - echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null 
     # - systemctl enable --now docker
  pre_build:
    commands:
      - echo "Login to docker hub"
      - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
  build:
    commands:
      - echo "starting creating image"
      - docker build -t $DOCKER_USER/buildcode:buidcode2 .
      
  post_build:
    commands:
       - echo "pushing image to docker hub"
       - docker images
       - docker push $DOCKER_USER/buildcode:buidcode2
artifacts:
  files:
    - kharatramesh/buildcode:buidcode1 
    